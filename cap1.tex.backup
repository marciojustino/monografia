\chapter{NTFS}
Projetado pela Microsoft, é o sistema de arquivos padrão de vários sistemas operacionais Microsoft desde a versão do Microsoft Windows NT (1993) até as versões mais recentes como o Windows 8 (2012). Sendo o predecessor do antigo sistema FAT, é o sistema mais presente em investigações de sistemas Windows \cite{ForensicAnalysis}.

\section{Conceito}
O sistema de arquivos NTFS foi projetado para melhor confiabilidade, segurança e suporte de grandes dispositivos de armazenamento de dados. Dispõe do uso de estruturas genéricas que servem de envoltório para estruturas de dados com conteúdo específico. Desta forma, o NTFS se torna um projeto escalável pois a estrutura interna de dados pode mudar inúmeras vezes enquanto que a sua casca (a estrutura genérica) permanece constante. Um bom exemplo desse modelo é que todos os bytes\footnote{Termo binário que representa 8 unidades da menor unidade de informação (bit) que pode ser armazenada ou transmitida \cite{WikiBytes}.} são alocados em arquivos no sistema \cite{ForensicAnalysis}.

\section{Estrutura de Dados}
Segundo Carrier (2005, p. 199)\nocite{ForensicAnalysis}, a única estrutura consistente no NTFS está presente nos primeiros setores do disco, contendo os setores de boot e código.

O coração do sistema de arquivos NTFS está na Master File Table (MFT) pois esta contém as informações de todos os diretórios. Todo arquivo e diretório existente possui uma entrada na MFT, sendo que esta é uma estrutura bem simples de 1 KB de tamanho. A Entrada na MFT possui:

\begin{itemize}
 \item Cabeçalho;
 \item Atributos; e
 \item Espaço não utilizado.
\end{itemize}

A figura \ref{fig:fig02} demonstra um registro de entrada na MFT.

\begin{figure}[htp]
  \centering
  \includegraphics[scale=0.6]{figuras/fig02.png}
  \caption{Entrada na MFT - Cabeçalho e espaço reservado aos diferentes tipos de atributos. Para o exemplo, a entrada possui 3 atributos.}
  \label{fig:fig02}
\end{figure}

\subsection{Cluster}
De acordo com Svensson (2005, p. 25), um disco rídigo é dividido em setores sendo que o sistema de arquivos se utiliza de setores para formar um cluster. O tamanho do cluster depende da formatação do disco. A tabela \ref{table:tab01} demonstra tamanhos padrões definidos de cluster para diferentes tamanhos e formas de formatação do disco NTFS:

\begin{table}[htb]
  \centering  
  \begin{tabular}{ll}
    \hline
    Tamanho do Disco & Tamanho do Cluster Padrão \\
    \hline
    até 512 MB & 512 bytes \\
    513 MB - 1024 MB & 1 KB \\
    1025 MB - 2048 MB & 2 KB \\
    acima de 2048 MB & 4 KB \\
    \hline
  \end{tabular}
  \label{tab01}
  \caption{Tamanho do Cluster Padrão Para Formatos NTFS.}
\end{table}

Como pode ser visto na tabela demonstrada por Svensson (2005, p. 25), quanto maior o tamanho do disco maior o tamanho do cluster.

Nos sistemas de arquivos NTFS, todos os clusters possuem um identificador chamado de \emph{Logical Cluster Number (LCN)}. O LCN é um número sequencial que se apresenta na ordem dos clusters, do começo do disco até o seu final, iniciando-se em 0 (zero), referindo ao setor de boot do sistema de arquivos. O sistema de arquivo converte o identificador LCN em um endereço físico de disco (posição dos bytes onde o cluster está localizado no disco), multiplicando o identificador LCN com o tamanho do cluster.

\section{Master File Table}
Segundo Svensson (2005, p. 26), todos os arquivos no sistema NTFS apresentam ao menos uma entrada no registro da Master File Table (MFT)\footnote{Conjunto de registros que são continuamente modificados quando um arquivo ou diretório sofre alteração}. Os primeiros 16 registros da MFT são reservados pelo sistema de arquivos para manter metadados\footnote{Dados que definem ou descrevem uma outra parte dos dados \cite{Metadados}.} específicos do NTFS. A tabela \ref{table:tab02}

\begin{table}[htb]
  \centering  
  \begin{tabular}{ll}
    \hline
    Nome MTF & Registro & Descrição \\
    \hline
    \$MFT & 0 & NTFS's Master File Table. Contém um arquivo base para cada arquivo ou diretório do disco. \\
    \$MFTMIRR & 1 & Uma cópia parcial da MFT que serve como backup para casos de falhas de um setor. \\
    \$LOGFILE & 2 & Log de transação de arquivos. \\
    \$VOLUME & 3 & Contém o número serial do volume e data de criação. \\
    \$ATTRDEF & 4 & Definição de atributos. \\
    . & 5 & Diretório raiz do disco. \\
    \$BITMAP & 6 & Contém um mapeamento binário de todos os clustes do volume (usados e não usados). \\
    \$BOOT & 7 & Registro de boot do drive\footnote{Unidade do disco físico presente no equipamento, normalmente sendo primário ou secundário.}. \\
    \$BADCLUS & 8 & Lista de setores com problemas no drive. \\
    \$SECURE & 9 & Contém uma única descrição de segurança para todos arquivos do volume. \\
    \$UPCASE & 10 & Mapeia caracteres em texto minúsculo para texto maiúsculo. \\
    \hline
  \end{tabular}
  \label{tab02}
  \caption{Tamanho do Cluster Padrão Para Formatos NTFS.}
\end{table}

\section{Alocação de Arquivos}
...

\section{Análise NTFS}
...